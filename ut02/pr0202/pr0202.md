# üìÑ PR0202: Conexi√≥n remota con SSH

## ‚úÖ Objetivos
- Profundizar conocimientos sobre usuarios y permisos en sistemas Linux.

## üîé Recursos
- [Box Ubuntu 22.04](https://app.vagrantup.com/generic/boxes/ubuntu2204)
- [How to change hostname on Ubuntu 22.04](https://linuxize.com/post/how-to-change-hostname-on-ubuntu-22-04/)
- [How to male Windows resolve local hosts by their name](https://superuser.com/questions/1182917/how-to-make-windows-resolve-local-hosts-by-their-name)

## üìå 1. Preparaci√≥n de la m√°quina y configuraci√≥n de la red

### Apartado 1
Entramos en la configuraci√≥n de nuestra m√°quina virtual y en red, a√±adimos un adaptador de red y lo ponemos en **Adaptador s√≥lo anfitri√≥n**. Tenemos tambi√©n el adaptador principal como **NAT** que es el que nos permite conectarnos a la red.

![Apartado 1](Imagenes/ej1A1.png)

### Apartado 2
Ponemos `ip a` para averiguar que IP tenemos en nuestra m√°quina. Como tenemos dos adaptadores, se indicar√°n cu√°l es cual.  
- **enp0s3:** Adaptador s√≥lo anfitri√≥n
    - **IP:** 192.168.56.103

- **enp0s8**: Adaptador NAT
    - **IP:** 10.0.3.15

Si no tuvieramos puesto el adaptador al haber creado la m√°quina, tend√≠amos que poner la red de manera manual y para ello habr√≠a que entrar en `sudo nano /etc/netplan/50-cloud-init.yaml` y ah√≠ pond√≠amos la IP.

![Apartado 2](Imagenes/ej1A2.png)


Luego, al guardar el archivo y salir, guardamos los cambios con `sudo netplan apply`. Pero como no es en este caso, solo ponemos `ip a`.

![Apartado 2_1](Imagenes/ej1A2_1.png)

Pero como lo hemos hecho antes de crear la m√°quina no har√≠a falta.  

Y en **Windows**, nuestro adaptador de VirtualBox, con el nombre de **Adaptador de Ethernet VirtualBox**, tenemos la IP **192.168.56.1**.

![Apartado 2_2](Imagenes/ej1A2_2.png)

### Apartado 3
Para poder conectarnos con **SSH**, vamos a tener que poner el **usuario** y la **IP del adaptador de red de s√≥lo anfitri√≥n** de tal manera que sea `ssh "usuario"@"IP"`.  

Luego nos pedir√° la contrase√±a, y si es todo correcto, ya estamos dentro de la terminal de la m√°quina de nuestro **Ubuntu Server** en nuestra m√°quina anfitriona.

![Apartado 3](Imagenes/ej1A3.png)

### Apartado 4
Para cambiar el hostname de nuestro equipo, es decir, si en mi m√°quina tengo al principio de la l√≠nea de comandos `hector@hbf-server:~$`, donde pone `hbf-server` se va a cambiar por el hostname que queramos. Donde pone `hector`, es el usuario con el que estamos conectados.  

Entonces, para cambiar el hostname, editamos el archivo con `sudo nano /etc/hostname`.

![Apartado 4](Imagenes/ej1A4.png)

Para comprobarlo, ponemos el comando `sudo hostnamectl`.

![Apartado 4_1](Imagenes/ej1A4_1.png)

Como Linux no reconoce la barra baja **"_"** al ponerlo de hostname, simplemente la ignora y nos quedar√≠a de hostname como `hbfserver`.

### Apartado 5
Para que resuelva localmente el nombre de nuestra m√°quina de **Ubuntu Server**, vamos a tener que ir al directorio en nuestra m√°quina anfitriona que es `C:\Windows\System32\drivers\etc` y editamos el archivo que es `host`. Ah√≠, pondremos la IP de la m√°quina y el hostname que tiene al final del documento como indica la siguiente captura.

![Apartado 5](Imagenes/ej1A5.png)

Ahora podemos entrar sin tener que poner la IP, ahora con poner el hostname, ya podemos acceder de manera remota. Puede existir que al guardarlo haya problemas de que el archivo es un archivo protegido y que al guardarlo, sea un archivo.txt. En mi caso lo he conseguido editar con el **Notepad++**.

![Apartado 5_1](Imagenes/ej1A5_1.png)

## üìå 2. Creaci√≥n del usuario y conexi√≥n SSH

### Apartado 1
Creamos el usuario con `sudo useradd -m -s /bin/bash "hbf_ssh"` y luego, le ponemos la contrase√±a con `sudo passwd hbf_ssh`.  

`-m` crea el directorio **/home** para los usuarios. `-s /bin/bash` a√±ade **Bash** como l√≠nea de comandos.

### Apartado 2
Iniciamos sesi√≥n con el nuevo usuario que hemos creado, en este caso, `hbf_ssh`.

![Apartado 2](Imagenes/ej2A2.png)

Si no llegase a funcionar, pondr√≠amos los siguientes comandos.
- `sudo systemctl status ssh` ‚Üí para comprobar el estado del servicio SSH.

- `sudo systemctl enable ssh` ‚Üí para inicializar el servicio SSH cada vez que se encienda la m√°quina.

### Apartado 3
En nuestra m√°quina anfitriona, ponemos en la terminal el comando `ssh-keygen` y generar√° dos claves que se encuentran en el directorio `C:\Users\Alumno\.ssh`, una p√∫blica con la extensi√≥n **.pub** y otra privada. Tenemos que enviar la clave p√∫blica a nuestra m√°quina.

![Apartado 3](Imagenes/ej2A3.png)


![Apartado 3_1](Imagenes/ej2A3_1.png)

Los nombres de las claves son:
- **id_ed25519** ‚Üí clave privada

- **id_ed25519.pub** ‚Üí clave p√∫blica

Para enviar la clave, tenemos que poner el comando en nuestra terminal `scp .ssh\id_ed25519.pub hector@192.168.56.103:~`.

Luego ponemos `ls` para comprobar que se ha pasado correctamente y vemos que tenemos un directorio que se llama **.ssh**.

![Apartado 3_2](Imagenes/ej2A3_2.png)

Ahora tenemos que a√±adir la clave hacia **authorized_keys** y para ello pondremos `cat id_ed25519.pub > .ssh\authorized_keys`. Si hubieran m√°s claves, lo ideal ser√≠a en vez de poner el signo **">"**, es mejor **">>"** porque as√≠ no sobreescribimos y borramos las dem√°s claves.

> üí° Lo que se puede hacer es desactivar la contrase√±a cada vez que iniciemos sesi√≥n. Para ello tenemos que hacerlo desde `sudo nano /etc/ssh/sshd_config`. Tenemos que encontrar la l√≠nea que empieza comentada por **PasswordAunthentication**, quitamos el comentario y cambiamos el **"yes"** por **"no"**. As√≠, cada vez que vayamos a iniciar sesi√≥n de manera remota, no pedir√° la contrase√±a porque va a revisar las claves p√∫blicas y privadas.

## üìå 3. Conexi√≥n transparente a Github
Entramos en GitHub, y en **Settings** de nuestra cuenta, vamos a **SSH and GPG keys**.

Como vamos a a√±adir una clave de SSH, en el apartado de **SSH keys** le damos al bot√≥n de **New SSH key**.

![Ejercicio 3](Imagenes/ej3.png)

Ahora, en la clave p√∫blica, le damos a editar con el bloc de notas y copiamos todo el contenido que tiene y lo pegamos.

![Ejercicio 3_1](Imagenes/ej3_1.png)

La a√±adimos y as√≠ se nos va a quedar cuando ya lo tengamos hecho.

![Ejercicio3_2](Imagenes/ej3_2.png)

---
### [‚¨ÖÔ∏è Volver a UT02](../index.md)
---