# üìÑ PR0401: Administraci√≥n remota en Windows

## üìå 1. Entorno virtualizado y preparaci√≥n de las m√°quinas
Para hacer la pr√°ctica, necesitaremos las siguientes m√°quinas en **VirtualBox**:
- Windows Server 2019 Datacenter con experiencia de escritorio  (o GUI para abreviar)
- Windows Server 2019 Datacenter en modo Core
- Windows Server 2016 Datacenter en modo Core

Todas las m√°quinas tienen solamente un adaptador de red en **puente** para tener acceso a Internet y no requerir de un adaptador secundario.

Vamos a ponerle los siguientes nombres de **Host** a las m√°quinas.
- Windows Server 2019 Datacenter GUI: **HBF-2019**
- Windows Server 2019 Datacenter Core: **HBF-CORE-2019**
- Windows Server 2016 Datacenter Core: **HBF-CORE-2016**

Para cambiar el nombre de la m√°quina tanto en la versi√≥n **GUI** como la **CORE**, podemos usar el mismo comando que es el siguiente:
```powershell
Rename-Computer -NewName HBF-2019 -Restart
```

Pero para que funcione correctamente, tendremos que hacerlo desde `Powershell`, porque desde el propio CMD no funciona.  
En la versi√≥n **GUI**, tendremos que abrir Powershell como **Adminstrador**, y en las versiones **CORE**, podremos hacerlo al escribir `powershell` y luego ejecutar el comando. Se nos reiniciar√°n las m√°quinas de manera autom√°tica al haber puesto `-Restart`.

Ahora, tendremos que a√±adirles una IP est√°tica. Esta va a ser una tabla de qu√© IPs van a tener las m√°quinas:

|Host         |IP          |M√°scara de subred  |Puerta de enlace|Servidor DNS|
|:-----------:|:----------:|:-----------------:|:--------------:|:----------:|
|HBF-2019     |192.168.1.10|255.255.255.0 /24  |192.168.1.1     |8.8.8.8     |
|HBF-CORE-2019|192.168.1.20|255.255.255.0 /24  |192.168.1.1     |8.8.8.8     |
|HBF-CORE-2016|192.168.1.30|255.255.255.0 /24  |192.168.1.1     |8.8.8.8     |

>üí¨ El DNS es opcional pero me apetec√≠a ponerlo.

### Versi√≥n GUI
Podemos cambiar la **IP** haciendo la combinaci√≥n de teclas `Win+R` y escribimos `ncpa.cpl`, con esto nos ahorramos algo de tiempo y es m√°s directo.  
Ahora, hacemos clic derecho en el adaptador de red y clicamos en `Propiedades`. Luego, clicamos en `Protocolo de Internet versi√≥n 4 (TCP/IPv4)`. Lo dejamos tal cual est√° en la captura.

![ip ws2019](Imagenes/IPestatica.png)

Podemos comprobarlo abriendo la terminal y escribiendo `ipconfig /all`.

![ipconfig2019](Imagenes/ipconfig2019.png)

Editamos el archivo `hosts` que se encuentra en `C:\Windows\System32\drivers\etc\hosts` para habilitar la resoluci√≥n local de nombres entre las dem√°s m√°quinas.  
Para editar este archivo, podemos hacerlo directamente entrando en el diretorio y editandolo con el **bloc de notas** y pondremos lo siguiente al final del documento:
```
192.168.1.10 HBF-2019
192.168.1.20 HBF-CORE-2019
192.168.1.30 HBF-CORE-2016
```

Y al guardar el archivo, lo m√°s seguro es que tengamos problemas al guardarlo por falta de permisos, nos recomienda guardarlo como un archivo `.txt` y guardarlo en `Documents`. Podemos quitarle la extensi√≥n y reemplazar el archivo viejo.

Por √∫ltimo, desactivamos el Firewall desde el **Panel de control** yendo hacia `Sistema y seguridad ‚Üí Firewall de Windows Defender` y en la parte de la izquierda, clicamos en `Activar o desactivar el Firewall de Windows Defender`. Clicamos en `Desactivar Firewall de Windows Defender` tanto en `Redes privadas` como en `Redes p√∫blicas o invitadas`, aceptamos y ya est√° desactivado el Firewall.

![Firewall](Imagenes/Firewall.png)

### Versi√≥n CORE
Para cambiar la IP, tenemos que poner el comando `New-NetIPAddress` para cambiar la IP y `Set-DnsClientServerAddress` para poner un servidor DNS. Pondremos lo siguiente con `Powershell`:

- **HBF-CORE-2019**
```powershell
New-NetIPAddress `
 -InterfaceAlias "Ethernet" `
 -IPAddress 192.168.1.20 `
 -PrefixLength 24 `
 -DefaultGateway 192.168.1.1

Get-WmiObject Win32_NetworkAdapterConfiguration | Where-Object {$_.IPEnabled -eq $true} | ForEach-Object { $_.SetDNSServerSearchOrder(@("8.8.8.8"))}
```

> üí¨ Para poder poner el DNS no funcionaba con el comando `Set-DnsClientServerAddress`, la √∫nica soluci√≥n para poder ponerlo ha sido as√≠. Esto solo ha sido en la versi√≥n de 2019, en la de 2016 no hay problema ninguno.

Comprobamos la configuraci√≥n poniendo el comando `Get-NetIPconfiguration`.

![IPconfiguration2019](Imagenes/IPconfiguration2019.png)

- **HBF-CORE-2016**
```powershell
New-NetIPAddress `
 -InterfaceAlias "Ethernet" `
 -IPAddress 192.168.1.30 `
 -PrefixLength 24 `
 -DefaultGateway 192.168.1.1

Set-DnsClientServerAddress `
 -InterfaceAlias "Ethernet" `
 -ServerAddresses 8.8.8.8
```

Comprobamos la configuraci√≥n poniendo el comando `Get-NetIPconfiguration`.

![IPconfiguration2016](Imagenes/IPconfiguration2016.png)

Para editar el archivo **hosts**, pondremos el comando `notepad C:\Windows\System32\drivers\etc\hosts` y se nos abrir√° el **Bloc de notas** y lo dejaremos exactamente igual que en la versi√≥n **GUI**, es decir, al final del documento pondremos esto:
```
192.168.1.10 HBF-2019
192.168.1.20 HBF-CORE-2019
192.168.1.30 HBF-CORE-2016
```

Para desactivar el **Firewall** en ambas m√°quinas, pondremos lo siguiente:
```powershell
Set-NetFirewallProfile `
-Profile Domain,Public,Private `
-Enabled False

Get-NetFirewallProfile | Select-Object Name, Enabled
```
- **HBF-CORE-2019**

![Firewall2019](Imagenes/Firewall2019.png)

- **HBF-CORE-2016**

![Firewall2016](Imagenes/Firewall2016.png)

Por √∫ltimo para acabar la configuraci√≥n de las m√°quinas, comprobaremos que se hagan ping entre ellas, he puesto el comando `ping` m√°s el nombre del Host de las m√°quinas para que aparezcan tanto el nombre y la IP que tienen.

- **HBF-2019**

![ping](Imagenes/ping.png)

- **HBF-CORE-2019**

![ping2019](Imagenes/ping2019.png)

- **HBF-CORE-2016**

![ping2016](Imagenes/ping2016.png)

## üìå 2. Configuraci√≥n del acceso remoto al nuevo equipo


## üìå 3. Configuraci√≥n del acceso remoto sobre HTTPS


## üìå 4. Configuraci√≥n remota con Windows Admin Center


---
### [‚¨ÖÔ∏è Volver a UT04](../index.md)
---