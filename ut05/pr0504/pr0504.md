# üìÑ PR0504: Directivas de seguridad, GPP y Filtros WMI

## üìÅ Parte 1: Endurecimiento de la seguridad
Creamos el GPO con el nombre de `GPO_Harden_Security_Equipos` en la UO de `_Equipos`.

![Crear GPO](Imagenes/Parte1.png)

Para hacer los ejercicios, haremos clic derecho y luego en **Editar**.

### üìå 1.1. Protecci√≥n de cuentas y acceso
- **Renombrar cuenta de administrador:** por seguridad, la cuenta local `Administrador` es un objetivo com√∫n de ataques. Configura la directiva para que esta cuenta se renombre a `Admin_Local_IES`.

Seguimos las rutas de la imagen:

![Cambiar nombre Administrador](Imagenes/Ej1-1.png)

- **Inicio de sesi√≥n interactivo:** configura el equipo para que no requiera pulsar `Ctrl+Alt+Supr` para iniciar sesi√≥n.

Seguiremos la ruta de la imagen:

![No requerir Ctrl+Alt+Supr](Imagenes/Ej1-1_1.png)

### üìå 1.2. Aviso legal (Consentimiento informado)
Configura el sistema para que, antes de iniciar sesi√≥n, muestre un mensaje legal a los usuarios.

- T√≠tulo del mensaje: `Aviso de Seguridad del IES San Andr√©s`

![Titulo](Imagenes/Ej1-2.png)

- Texto del mensaje: `El uso de este equipo est√° monitorizado. El acceso est√° restringido √∫nicamente a personal y alumnado autorizado.`

![Texto](Imagenes/Ej1-2_1.png)

### üìå 1.3. Privacidad y apagado
- **Privacidad:** Configura el inicio de sesi√≥n interactivo para que **no muestre el √∫ltimo nombre de usuario** que inici√≥ sesi√≥n.

![Privacidad](Imagenes/Ej1-3.png)

- **Apagado:** Deshabilita la opci√≥n que permite **apagar el sistema sin tener que iniciar sesi√≥n**.

![Apagado](Imagenes/Ej1-3_1.png)

## üìÅ Parte 2: Preferencias de grupo (GPP) y segmentaci√≥n
Las GPP funcionan igual que las GPO pero, en vez de escoger las directivas en la estructura de carpetas cuando se le va a asignar algo a una GPO, vamos a la carpeta de Preferencias y haremos los ejercicios desde ah√≠.  
Creamos una GPO con el nombre de `GPO_Configuracion_Usuario_Dinamica` que estar√° vinculada a la UO de todo nuestro dominio.

![GPO UO principal](Imagenes/Parte2.png)

### üìå 2.1. Mapeo de unidades de red (Drive Maps)
- Crea una unidad de red mapeada (letra `P:`) que apunte a una carpeta compartida llamada `Recursos_Profesores`.
- **Requisito:** Usa **Item-Level Targeting (Destinatarios)** para que esta unidad **SOLO** se monte si el usuario pertenece al grupo `GRP_Profesores_General`.

Lo primero que haremos es crear una carpeta llamada `Recursos_Profesores` dentro de `C:\Shares`. En las Propiedades, vamos a la pesta√±a de **Compartir** y luego al bot√≥n de **Configuraci√≥n avanzada**. Metemos al grupo `GRP_Profesores_General`, le damos Control total y quitamos al resto de usuarios y grupos.

![Compartir grupo Profesores](Imagenes/Ej2-1.png)

La ruta ser√° `\\HBF-WSERVER\Recursos_Profesores`.

Cuando lo tengamos, tendremos que ir a la ventana donde configuramos anteriormente los GPO, hacemos clic derecho y **Editar** en el GPO que hemos creado para el ejercicio.  
Se abrir√° un men√∫ como en los ejercicios anteriores donde hemos trabajado con las directivas, pero esta vez desplegamos en **Configuraci√≥n de usuario ‚Üí Preferencias ‚Üí Configuraci√≥n de Windows** y buscamos la opci√≥n de **Asignaciones de unidades**. Hacemos primero clic izquierdo y despu√©s clic derecho sobre el espacio en blanco y clicamos en **Nueva propiedad de controlador**.

![Asignaciones de unidades](Imagenes/Ej2-1_1.png)

Se abrir√° una ventana a la que tendremos que dejarla como en la imagen.

![Propiedades de controlador](Imagenes/Ej2-1_2.png)

Para ponerle el requisito para que solo afecte al grupo de `GRP_Profesores_General`, tenemos que ir a la pesta√±a **Comunes**, marcamos el √∫ltimo "checkbox" que viene y clicamos en el bot√≥n de **Destinatarios...** para elegir a que objeto queremos que haga referencia.

![Propiedades de P:](Imagenes/Ej2-1_3.png)

Se abrir√° una ventana en la que debemos darle al desplegable de la parte superior izquierda que se llama **Nuevo elemento**. Se desplegar√° una lista y tenemos que seleccionar **Grupos de seguridad** que tiene el icono de dos cabezas.

A√±adimos el grupo clicando en los tres puntos y le damos a **Aplicar**.

![Grupo de seguridad](Imagenes/Ej2-1_4.png)

### üìå 2.2. Accesos Directos (Shortcuts)
- Crea un acceso directo en el Escritorio que apunte a `http://intranet.iessanandres.local` (puedes inventar la URL).
- **Requisito:** Usa **Item-Level Targeting** para que este acceso directo **SOLO** aparezca a los miembros del grupo `GRP_Alumnos_DAM`.

Estando en el mismo lugar que en el ejercicio anterior, vamos ahora hacia **Accesos directos**. Hacemos clic derecho en **Nuevo ‚Üí Acceso directo**.

![Crear acceso directo](Imagenes/Ej2-2.png)

Rellenamos la ventana que nos ha salido de manera que quede como en la de la imagen:

![Propiedades acceso directo](Imagenes/Ej2-2_1.png)

Ahora, para conectarlo al grupo de `GRP_Alumnos_DAM`, haremos exactamente lo mismo que en el ejercicio anterior, en las Propiedades, marcamos el √∫ltimo "checkbox" y clic en **Destinatarios...**, a√±adimos al grupo.

![A√±adir grupo Alumnos DAM](Imagenes/Ej2-2_2.png)

### Comprobaciones
- Comprobaci√≥n del ejercicio 2.1.

Iniciamos sesi√≥n con el usuario `prof_info_1`.  
El resultado que se ha obtenido es que podemos ver el recurso compartido en **Ubicaciones de red** desde el **Explorador de archivos**.
> üí¨ En mi caso no ha funcionado, pero ver√≠amos lo mismo como hemos hecho con los alumnos en ejercicios anteriores.

- Comprobaci√≥n del ejercicio 2.2.

Iniciamos sesi√≥n con el usuario `alu_dam_1`.  
> üí¨ Se ha tenido que crear al usuario y agregarlo al grupo GRP_Alumnos_DAM.

![Ver intranet](Imagenes/Ej2-2_3.png)

## üìÅ Parte 3: Filtrado WMI Avanzado
### üìå 3.1. Gesti√≥n de Memoria Virtual
Creamos el GPO con el nombre de `GPO_HighPerf_Security` y lo vinculamos a nuestro dominio ra√≠z de esta manera:

![GPO dominio ra√≠z](Imagenes/Ej3-1.png)

- Habilitar la directiva: **Computer Configuration ‚Üí Policies ‚Üí Windows Settings ‚Üí Security Settings ‚Üí Local Policies ‚Üí Security Options**.

![Habilitar borrar archivo paginaci√≥n](Imagenes/Ej3-1_1.png)

- Crea y vincula un **Filtro WMI** que haga que esta GPO solo se aplique a equipos que tengan **m√°s de 4 GB de memoria RAM**.

Lo que haremos primero, es crear el Filtro WMI desde **Administraci√≥n de directivas de grupo**, en **Filtros WMI** hacemos clic derecho y **Nuevo**.

![Crear filtro](Imagenes/Ej3-1_2.png)

Ponemos el nombre y la descripci√≥n que sea clara, tambi√©n, clicaremos en el bot√≥n de **Agregar** y a√±adimos el factor que le queremos hacer el filtro, escribiremos:
```
SELECT * FROM Win32_ComputerSystem WHERE TotalPhysicalMemory >= 4294967296
```

![Nuevo filtro](Imagenes/Ej3-1_3.png)

Volvemos al GPO que hemos creado, le damos un clic para entrar en √©l y en la parte inferor donde pone **Filtrado WMI**, seleccionaremos el filtro que acabamos de crear.

![Seleccionar filtro](Imagenes/Ej3-1_4.png)

Saldr√° un aviso de si queremos aplicarlo y le damos que **S√≠**.

### üìå 3.2. Diferenciaci√≥n de Sistema Operativo (Workstation vs Server)
Creamos otro GPO en nuetro dominio ra√≠z con el nombre de `GPO_Clientes_UAC`.

![Crear GPO en dominio ra√≠z](Imagenes/Ej3-2.png)

- Configurar la directiva de UAC para deshabilitar la detecci√≥n de instalaciones.

Vamos a Editar nuestro GPO y seguimos los pasos de la imagen:

![Deshabilitar detecci√≥n instalaciones](Imagenes/Ej3-2_1.png)

- Crear y vincular un Filtro WMI que seleccione √∫nicamente sistemas operativos de escritorio (no servidores).

Vamos a Filtros WMI, hacemos clic derecho y Nuevo. Creamos el filtro con lo siguiente:  
En la consulta, escribiremos:
```
SELECT * FROM Win32_OperatingSystem WHERE ProductType = 1
```

![Crear filtro seleccionar SO](Imagenes/Ej3-2_2.png)

Luego, lo agregaremos al GPO que hemos creado para el ejercicio.

![Agregar filtro](Imagenes/Ej3-2_3.png)

---
### [‚¨ÖÔ∏è Volver a UT05](../index.md)
---