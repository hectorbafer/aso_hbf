# üìÑ PR0604: Manipulaci√≥n de colecciones en PowerShell
> üí¨ Para hacer los ejercicios, se pondr√° a la vez en el mismo cuadro el comando de entrada y de salida acompa√±ado de la captura de pantalla para ver el resultado.

## üìÅ Parte 1: Arrays fijos
### üìå 1. Reconfiguraci√≥n de DNS y Verificaci√≥n
**Paso 1:** Declara el array con los valores iniciales: `192.168.1.10` (Primario) y `10.0.0.50` (Secundario err√≥neo).
```powershell
$dns = @("192.168.1.10", "10.0.0.50")
```

> üí¨ El primero se encuentra en la posici√≥n 0 y el segundo en la posici√≥n 1.

**Paso 2:** Muestra en pantalla: ‚ÄúConfiguraci√≥n actual: [Primario] - [Secundario]‚Äù.
```powershell
"Configuraci√≥n actual: $($dns[0]) - $($dns[1])"
```

![Configuraci√≥n actual](Imagenes/Ej1-2.png)

**Paso 3:** Accede directamente al √≠ndice correspondiente y cambia la IP del secundario por la de Google: `8.8.8.8`.
```powershell
$dns[1] = "8.8.8.8"
```

**Paso 4:** Muestra en pantalla el n√∫mero total de servidores DNS configurados.
```powershell
"N√∫mero total de servidores DNS: $($dns.Count)"
```

![Contar DNS](Imagenes/Ej1-4.png)

**Paso 5:** Muestra la configuraci√≥n final corregida.
```powershell
"Configuraci√≥n final: $($dns[0]) - $($dns[1])"
```

![Configuraci√≥n final](Imagenes/Ej1-5.png)

### üìå 2. Rotaci√≥n de logs de backups (LIFO - Last In, First Out)
**Paso 1:** Declara el array con las siguientes cadenas: `Backup_Lunes.zip`, `Backup_Martes.zip`, `Backup_Miercoles.zip`.
```powershell
$backups = @("Backup_Lunes.zip", "Backup_Martes.zip", "Backup_Miercoles.zip")
```

**Paso 2:** Guarda en una variable `$oldest` el primer elemento.
```powershell
$oldest = $backups[0]
```

**Paso 3:** Guarda en una variable `$newest` el √∫ltimo elemento.
```powershell
$newest = $backups[2]
```

**Paso 4:** El backup del Mi√©rcoles ha salido corrupto. Modifica el √∫ltimo elemento del array a√±adi√©ndole el texto " (CORRUPTO)" al final del nombre.
```powershell
$backups[2] = $backups[2] + " (CORRUPTO)"
```

**Paso 5:** Imprime un resumen: "Rotaci√≥n de backups: Del [Viejo] al [Nuevo]".
```powershell
"Rotaci√≥n de backups: Del $oldest al $($backups[2])"
```

![](Imagenes/Ej2-5.png)

## üìÅ Parte 2: ArrayList
### üìå 3. Gesti√≥n de Cola de incidencias (Priorizaci√≥n)
**Paso 1:** Crea un `ArrayList` vac√≠o.
```powershell
$incidencias = New-Object System.Collections.ArrayList
```

**Paso 2:** A√±ade las incidencias: "Monitor parpadea" y "Rat√≥n no va". (Recuerda ocultar la salida por pantalla del `.Add()`).
```powershell
[void]$incidencias.Add("Monitor parpadea")
[void]$incidencias.Add("Rat√≥n no va")
```

**Paso 3:** Llega una urgencia: Inserta en la posici√≥n 0 la incidencia: "SERVIDOR CA√çDO".
```powershell
$incidencias.Insert(0, "SERVIDOR CA√çDO")
```

**Paso 4:** El t√©cnico resuelve la incidencia del "Rat√≥n". B√∫scala por su nombre y elim√≠nala de la lista.
```powershell
$incidencias.Remove("Rat√≥n no va")
```

**Paso 5:** Imprime la lista actual de tareas pendientes y cuenta cu√°ntas quedan.
```powershell
$incidencias
"Total de incidencias: $($incidencias.Count)"
```

![Resultado incidencias](Imagenes/Ej3-5.png)

### üìå 4. Validaci√≥n de lista negra de IPs (Seguridad)
**Paso 1:** Inicializa un `ArrayList` con las IPs ya bloqueadas: `10.10.10.5`, `192.168.50.4`, `80.80.80.80`.
```powershell
$listaNegra = New-Object System.Collections.ArrayList
[void]$listaNegra.Add("10.10.10.5")
[void]$listaNegra.Add("192.168.50.4")
[void]$listaNegra.Add("80.80.80.80")
```

**Paso 2:** Declara una variable `$nuevaAmenaza = "192.168.50.4"`.
```powershell
$NuevaAmenaza = "192.168.50.4"
```

**Paso 3:** Usa una estructura `if` para:
- Si la IP ya est√° en la lista, muestra: "La IP [IP] ya estaba bloqueada. No se hace nada."
- Si no est√°, a√±√°dela a la lista y muestra: "IP [IP] a√±adida a la lista negra."
```powershell
if ($ListaNegra -contains $NuevaAmenaza) {
Write-Host "La IP $NuevaAmenaza ya estaba bloqueada. No se hace nada." -ForegroundColor Yellow
} else {
[void]$ListaNegra.Add($NuevaAmenaza)
Write-Host "La IP $NuevaAmenaza se ha a√±adido a la lista negra." -ForegroundColor Red
}
```

![Comprobar IP](Imagenes/Ej4-3.png)

**Paso 4:** Muestra la lista final ordenada alfab√©ticamente.
```powershell
$ListaNegra.Sort()
$ListaNegra
```

![Mostrar lista](Imagenes/Ej4-4.png)

## üìÅ Parte 3: Listas gen√©ricas
### üìå 5. Hardening de puertos de Firewall (List[int])
**Paso 1:**
```powershell
$puertos = [System.Collections.Generic.List[int]]::new()
```

**Paso 2:**
```powershell
$puertos.Add(80)
$puertos.Add(443)
$puertos.Add(53)
```

**Paso 3:**
```powershell
$puertos.Add(23)
```

**Paso 4:**
```powershell
$puertos.Remove(23)
```

![Quitar puerto](Imagenes/Ej5-4.png)

**Paso 5:**
```powershell
$puertos.Add("HTTP")
```

![Error](Imagenes/Ej5-5.png)

> üí¨ Da error porque la lista solo acepta enteros *(int)* y no texto *(string)*

**Paso 6:**
```powershell
$puertos.Sort()
"Puertos autorizados en el Firewall (Hardened)"
$puertos
```

![Mostrar lista](Imagenes/Ej5-6.png)

### üìå 6. Inventario de servicios cr√≠ticos (List[string])
**Paso 1:**
```powershell
$arrayServicios = @("Spooler", "W3SVC", "LanmanWorkstation")
$servicios = [System.Collections.Generic.List[string]]::new([string[]]$arrayServicios)
```

**Paso 2:**
```powershell
$servicios.Add("wuauserv")
```

**Paso 3:**
```powershell
$serviciosOrdenados = $servicios | Sort-Object
```

**Paso 4:**
```powershell
foreach ($servicios in $serviciosOrdenados) {
"Monitorizando servicio: $($servicios) ...OK"}
```

![Monitorizar servicios](Imagenes/Ej6-4.png)

## üìÅ Parte 4: Manipulaci√≥n de texto
### üìå 7. An√°lisis de Log de usuario
**Entrada:**
```powershell
$logLine = " User: admin ; IP: 192.168.1.55 ; Status: Failed "
```
(Nota los espacios extra al principio y final).

**Paso 1:**
```powershell
$logLineLimpio = $logLine.Trim()
```

**Paso 2:**
```powershell
$partes = $logLineLimpio.Split(";")
```

**Paso 3:**
```powershell
$usuario = $partes[0].Split(":")[1].Trim()
```

**Paso 4:**
```powershell
$ip = $partes[1].Split(":")[1].Trim()
```

**Paso 5:**
```powershell
"ALERTA: El usuario $($usuario) intent√≥ conectar desde $($ip)"
```

![Alerta](Imagenes/Ej7-5.png)

### üìå 8. Generador de CSV para recursos humanos
**Paso 1:**
```powershell
$m1 = "ana@empresa.com"
$m2 = "luis@empresa.com"
$m3 = "bea@empresa.com"
```

**Paso 2:**
```powershell
$emails = @($m1, $m2, $m3)
```

**Paso 3:**
```powershell
$listaEmails = $emails -join ","
```

**Paso 4:**
```powershell
$csvFinal = "EmailAddress, $($listaEmails)"
```

**Paso 5:**
```powershell
$csvFinal
```

![Ver CSV](Imagenes/Ej8-5.png)

---
### [‚¨ÖÔ∏è Volver a UT06](../index.md)
---