# üìÑ PR0606: Limpieza de logs (II)
## üìå 1. Objetivo
Eres el responsable de infraestructura de una plataforma de E-Commerce. Un sistema de inventario de hace 10 a√±os est√° registrando los movimientos de stock en un archivo de texto con un formato inconsistente. Necesitas procesar estos datos para generar un informe de discrepancias cr√≠ticas en formato CSV que el equipo de almac√©n pueda importar en Excel.

## üìå 2. Datos de entrada
```powershell
$movimientosCrudos = @"
[LOG-OK] SKU:A199 :: 2024.01.10_08:00 :: Item:Smartphone_X :: Qty:50 :: Status:In_Stock
[LOG-ALERT] SKU:B250 :: 10-01-2024 09:15 :: Item:LAPTOP-PRO :: Qty:-5 :: Status:Damaged
[LOG-OK] SKU:C312 :: 2024/01/10_10:30 :: Item:tablet_air :: Qty:120 :: Status:In_Stock
[LOG-CRIT] SKU:D400 :: 11/01/2024_11:45 :: Item:UNKNOWN_ITEM :: Qty:0 :: Status:Out_Of_Order
"@
```

## üìå 3. Requisistos
```powershell
$movimientosCrudos = @"
[LOG-OK] SKU:A199 :: 2024.01.10_08:00 :: Item:Smartphone_X :: Qty:50 :: Status:In_Stock
[LOG-ALERT] SKU:B250 :: 10-01-2024 09:15 :: Item:LAPTOP-PRO :: Qty:-5 :: Status:Damaged
[LOG-OK] SKU:C312 :: 2024/01/10_10:30 :: Item:tablet_air :: Qty:120 :: Status:In_Stock
[LOG-CRIT] SKU:D400 :: 11/01/2024_11:45 :: Item:UNKNOWN_ITEM :: Qty:0 :: Status:Out_Of_Order
"@ -split '\r?\n'

$objetosProcesados = foreach ($linea in $movimientosCrudos) {
    if ([string]::IsNullOrWhiteSpace($linea) -or $linea -match "^\[LOG-OK\]") { continue }

    $partes = $linea -split " :: "
    
    # Procesar Item con l√≥gica especial
    $itemRaw = ($partes[2].Split(':')[1]).ToUpper()
    if ($itemRaw -eq "UNKNOWN_ITEM") { $itemRaw = "PENDING_REVIEW" }

    # Procesar Status y ActionRequired
    $statusRaw = $partes[4].Split(':')[1]
    $accion = if ($statusRaw -eq "Damaged") { "Repair" } else { "Replace" }

    [PSCustomObject]@{
        SKU            = $partes[0].Split(':')[1]
        Fecha          = (Get-Date $partes[1].Replace('.','/').Replace('_',' ')).ToString("dd/MM/yyyy HH:mm")
        Producto       = $itemRaw
        Cantidad       = $partes[3].Split(':')[1]
        Estado         = $statusRaw
        ActionRequired = $accion
    }
}

# Salida compacta
$objetosProcesados | Export-Csv -Path "reporte_inventario.csv" -NoTypeInformation
$objetosProcesados | Format-Table -AutoSize
```

## üìå 4. Resultado
```
SKU  Fecha            Producto       Cantidad Estado       ActionRequired
---  -----            --------       -------- ------       --------------
B250 10/01/2024 09:15 LAPTOP-PRO     -5       Damaged      Repair
D400 11/01/2024 11:45 PENDING_REVIEW 0        Out_Of_Order Replace
```

---
### [‚¨ÖÔ∏è Volver a UT06](../index.md)
---